variables:
  SCCACHE_CACHE_FOLDER: $(Pipeline.Workspace)/.cache/sccache
  CONTAINER_VERSION: 1.36
trigger:
- master
jobs:
- job: bash_env
  pool:
    vmImage: 'ubuntu-16.04'
  container: rust:$(CONTAINER_VERSION)
  steps:
    - script: echo "##vso[task.setvariable variable=AAABC;isOutput=true]$CARGO_HOME"
      name: cargo_home
- job:
  dependsOn: bash_env
  pool:
    vmImage: 'ubuntu-16.04'
  container: rust:$(CONTAINER_VERSION)
  variables:
    AA: $[dependencies.bash_env.outputs]
  steps:
    - script: echo "$AA"
    - task: CacheBeta@0
      inputs:
        key: |
          cargo
          $(Agent.OS)
          $(Agent.OSArchitecture)
        path: $(CARGO_CACHE_FOLDER)
      enabled: false
    - script: export
      displayName: List variables
      enabled: false
    - script: rustup component add clippy
      displayName: Setup Clippy
      enabled: false
    - script: cargo build
      displayName: Build
      enabled: false
    - script: cargo clippy
      displayName: Clippy
      enabled: false
    - script: rm -rf $(CARGO_HOME)/.cargo/registry/src
      displayName: Reduce cargo cache
      enabled: false
